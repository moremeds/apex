name: pulse_dip
tier: "TIER 1"
module_path: "src.domain.strategy.signals.pulse_dip"
class_name: "PulseDipSignalGenerator"

# Current best parameters — used by all runners, playbooks, signal generators
# v2: Upgraded to use TrendPulse + DualMACD indicators for parity with
# the event-driven PulseDipStrategy.
params:
  # PulseDip-specific (dip buying)
  rsi_period: 14
  rsi_entry_threshold: 35.0

  # Trend filter (shared with TrendPulse)
  ema_trend_period: 99
  trend_strength_moderate: 0.15
  norm_max_adx: 50.0

  # Chop filter
  adx_entry_min: 15.0

  # DualMACD params (shared with TrendPulse)
  slow_fast: 55
  slow_slow: 89
  slow_signal: 34
  slope_lookback: 3
  exit_bearish_bars: 3

  # TrendPulse indicator params
  zig_threshold_pct: 3.5
  swing_filter_bars: 5
  trend_strength_strong: 0.6
  top_wr_main: 34

  # Risk management
  atr_stop_mult: 2.5
  hard_stop_pct: 0.08
  risk_per_trade_pct: 0.05
  min_confluence_score: 20
  max_hold_bars: 40

# Parameter iteration history (most recent first)
history:
  - version: "v2.2-r1-broadening"
    date: "2026-02-08"
    source: "Phase C+ dashboard-driven hardening"
    changes:
      - "Added min_confluence_score and max_hold_bars to YAML (were in ctor but missing from YAML)"
      - "Fixed risk_per_trade_pct ctor default 0.02 → 0.05 to match YAML"
      - "Added R1 to regime gate with 0.5x size factor (was 100% R0-concentrated)"
    params:
      rsi_period: 14
      rsi_entry_threshold: 35.0
      ema_trend_period: 99
      atr_stop_mult: 2.5
      hard_stop_pct: 0.08
      risk_per_trade_pct: 0.05
      min_confluence_score: 20
      max_hold_bars: 40
    reason: "100% R0 concentration → ~75-85% with R1 at 0.5x; YAML sync for 2 missing params"

  - version: "v2.1-exit-tuning"
    date: "2026-02-08"
    source: "Phase B4 hardening — tighter trail, split exits, win-target"
    changes:
      - "Tightened atr_stop_mult 3.0 → 2.5 (dip-buy bounce target is closer)"
      - "Split exits: RSI > 65 → partial (50%), TrendPulse top → full"
      - "Win-target trail: gain > 2*ATR tightens trail to 1.5*ATR"
      - "Playbook warmup 120 → 260 to match signal generator"
      - "hard_stop_pct now parameterized (was hardcoded 0.08)"
    params:
      rsi_period: 14
      rsi_entry_threshold: 35.0
      ema_trend_period: 99
      trend_strength_moderate: 0.15
      adx_entry_min: 15.0
      atr_stop_mult: 2.5
      hard_stop_pct: 0.08
      exit_bearish_bars: 3
    reason: "Sharpe 0.08 → target 0.3+ via tighter exits and partial profit-taking"

  - version: "v2.0-parity"
    date: "2026-02-08"
    source: "Upgraded signal generator to TrendPulse+DualMACD for VBT/event-driven parity"
    changes:
      - "Added TrendPulse EMA-99 trend filter + trend_strength"
      - "Added ADX chop filter (adx_entry_min)"
      - "Added DualMACD confluence (bullish/improving/deteriorating)"
      - "Added DualMACD bearish exit + TrendPulse top_detected exit"
      - "Warmup increased from 120 to 260 bars"
    params:
      rsi_period: 14
      rsi_entry_threshold: 35.0
      ema_trend_period: 99
      trend_strength_moderate: 0.15
      adx_entry_min: 15.0
      atr_stop_mult: 3.0
      hard_stop_pct: 0.08
      exit_bearish_bars: 3
    reason: "Match event-driven PulseDipStrategy core signal logic"

  - version: "v1.0-manual"
    date: "2025-12-01"
    source: "Hand-tuned initial params"
    params:
      ema_trend_period: 99
      rsi_period: 14
      rsi_entry_threshold: 35.0
      atr_stop_mult: 3.0
      max_hold_bars: 40
      hard_stop_pct: 0.08
    reason: "Initial hand-tuned params (simple EMA+RSI only)"
